<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Your Passwords</title>
    <style>
        .secret span {color: white;}
        .secret span::-moz-selection {background: black; color: black;}
        .secret span::-webkit-selection {background: black; color: black;}
        .secret span::selection {background: black; color: black;}
        
        .secret.copied span:after {
            content: 'Copied!';
            padding-left: 0.5em;
            color: black;
        }
    </style>

</head>
<body>
<h1>Hello, {{ user.username }}!</h1>
<h2>Your passwords</h2>
<p>Click to password cell to copy</p>
<table>
    <thead>
        <tr>
            <th>Description</th>
            <th>Password</th>
            <th>Delete?</th>
        </tr>
    </thead>
    <tbody>
        {% if flag %}
        <tr>
            <td>Top secret</td>
            <td><span class="secret">{{ flag }}</span></td>
            <td><em>Protected</em></td>
        </tr>
        {% endif %}
        {% for password in passwords %}
        <tr>
            <td>{{ password.description }}</td>
            <td class="secret"><span>{{ password.password }}</span></td>
            <td><form method="post" action="passwords/{{ password.id }}"><button>Delete</button></form></td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<h2>New password</h2>
<form method="post" action="">
    {% if error %}
    <p>{{ error }}</p>
    {% endif %}
    <input type="text" name="description" placeholder="Description" required />
    <input type="password" name="password" placeholder="Password" required />
    <button>Add</button>
</form>
<p><a href="logout">Logout</a></p>
<script>
    window.onload = function() {
        document.querySelectorAll('.secret').forEach(e => e.addEventListener('click', function() {
            if (e.timer) {
                clearTimeout(e.timer);
            }

            window.getSelection().selectAllChildren(e.querySelector('span'));
            document.execCommand('copy');

            e.className = 'secret copied';
            e.timer = setTimeout(function() {
                e.className = 'secret';
            }, 5000)
        }));
    };
</script>
</body>
</html>
