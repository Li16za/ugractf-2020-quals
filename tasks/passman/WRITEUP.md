# Менеджер паролей: Write-up

На сайте можно завести аккаунт, в котором есть единственная возможность — добавить или удалить пароль.

Давайте узнаем, как сайт авторизует нас. При входе сохраняется cookie с именем `session` — это base64-представление каких-то бинарных данных. Обратим внимание на следующие моменты:

* при авторизации под одним и тем же аккаунтом большая часть сессии остаётся неизменной
* при авторизации под разными логинами длина сессии изменяется ровно на столько же символов, на сколько отличаются длины логинов

Эти факты наводят на мысль, что сессия зашифрована поточным шифром, при этом в ней записаны какие-то неизменяемые данные пользователя.

Попробуем подобрать ключ шифрования. Для этого залогинимся разными пользователями с достаточно длинным именем пользователя — например, максимальным, длиной в 32 символа. Видим, что изменения затрагивают только два места. Посмотрим их шестнадцатеричное представление:

```diff
e97f7f887f0a33705f7fe76a9b32149e5380deeb6215f279ff76f18756bd6c4e224ec523ec0055ea38bd337b82b7153231af35fc95bc5c76bc8e06fc0bf21f84c1a1d1c8ffe0fe
e97f7f887f0a33705f7fe76a9b32149e5380deeb6119f279ff76f18756bd6c4e224ec523ec5106bb6fec602adde6466362fe62adc6ed0327efdf55ad5ca34cd59ef08298afe0fe
```

Можно заметить, что начиная с 38-го байта, XOR байтов этих строк равен XOR байтов выбранных нами имён пользователей. Следовательно, скорее всего, используется обычный XOR с общим дл всего сервера ключом. Этот менеджер паролей и вправду безопасен!

> Начиная с 21-го байта, также есть различие, но пока пропустим его исследование и возьмём эти байты с любой куки.

Мы хотим авторизоваться под пользователем `epicleeter`, поэтому получим куку для любого пользователя с длиной логина в 10 символов. Например, `adminadmin`:

```
e97f7f887f0a33705f7fe76a9b32149e5380dfee6b16f279ff76f18756bd6c4e224ec523ec5100b562e76729d8e642207d
e97f7f887f0a33705f7fe76a9b32149e5380dfee6b16f279ff76f18756bd6c4e224ec523ec5514b168e56328c1ea5e207d
```

Имя пользователя `adminadmin` шифруется строкой `5100b562e76729d8e642` в шестнадцатеричном представлении. Операцией XOR получаем соответствующие байты ключа: `3064d80b89064db58f2c`. И, наконец, мы можем сделать XOR ключа и нужного имени пользователя, получив `5514b168e56328c1ea5e`. Вставляем фрагмент обратно в сессию, кодируем её в base64 и заходим с этой сессией.

Мы залогинились под пользователем `epicleeter` и получили флаг.

## Что можно было ещё узнать

Мы уже говорили, что есть и другое различие в сессиях — около 21-го байта встречаются изменения, которые мы игнорировали в нашем решении. Мы можем заметить, что число различающихся байт зависит от того, насколько отличалось время входа в аккаунт. На самом деле, в сессии была зашифрована строка вида

```json
{"created": unix_timestamp, "username": "your-username"}
```

Однако, выяснение этого факта не требовалось для успешного решения задания.

Флаг: **ugra_lets_forget_xor_forever_2ff9399d0341**.
